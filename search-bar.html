<!-- Morphing Search -->
<div id="search-morph-container" class="search-morph-container pill-state" aria-live="polite">
  <div id="search-morph-bar" class="search-morph-bar" role="button" aria-label="Open search">

    <!-- Pill state (visible when collapsed) -->
    <div class="search-input-row">
      <div class="search-pill-content" aria-hidden="true">
        <svg class="search-pill-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <circle cx="11" cy="11" r="7" stroke="currentColor" stroke-width="2"></circle>
          <line x1="16.65" y1="16.65" x2="21" y2="21" stroke="currentColor" stroke-width="2" stroke-linecap="round"></line>
        </svg>
        <span class="search-pill-text">Search</span>
        <span class="search-badge" id="search-badge" aria-label="Active filters count">0</span>
      </div>

      <!-- Expanded content (shows when expanded) -->
      <div class="search-expanded-content" role="group" aria-label="Search">
        <svg class="search-icon-expanded" width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <circle cx="11" cy="11" r="7" stroke="currentColor" stroke-width="2"></circle>
          <line x1="16.65" y1="16.65" x2="21" y2="21" stroke="currentColor" stroke-width="2" stroke-linecap="round"></line>
        </svg>

        <input id="search-input-field" class="search-input-field" type="text"
               placeholder="Try a phrase, date range, or categoryâ€¦" autocomplete="off" aria-label="Search input" />

        <!-- Close (X) -->
        <button id="collapse-search" class="collapse-btn" type="button" aria-label="Close search">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <line x1="18" y1="6" x2="6" y2="18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            <line x1="6" y1="6" x2="18" y2="18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
        </button>
      </div>
    </div>

    <!-- Chips row -->
    <div class="search-actions search-actions-row">
      <button id="date-toggle" class="mode-toggle" type="button" aria-pressed="false" aria-controls="search-date-section" aria-expanded="false">
        <svg viewBox="0 0 24 24" aria-hidden="true">
          <rect x="3" y="5" width="18" height="16" rx="2" ry="2" stroke="currentColor" fill="none" stroke-width="2"/>
          <line x1="16" y1="3" x2="16" y2="7" stroke="currentColor" stroke-width="2"/>
          <line x1="8" y1="3" x2="8" y2="7" stroke="currentColor" stroke-width="2"/>
          <line x1="3" y1="11" x2="21" y2="11" stroke="currentColor" stroke-width="2"/>
        </svg>
        <span>Date range</span>
      </button>

      <button id="filter-toggle" class="mode-toggle" type="button" aria-pressed="false" aria-controls="search-categories-section" aria-expanded="false">
        <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <path d="M10 18h4v-2h-4v2zM3 6v2h18V6H3zm3 7h12v-2H6v2z" fill="currentColor"/>
        </svg>
        <span>Category</span>
      </button>

      <!-- Empty state helper hint -->
      <div id="search-empty-hint" class="search-empty-hint" aria-hidden="true">
        Try a phrase ("railway"), drag the date, or pick a category
      </div>
      
      <!-- Inline results text -->
      <div id="search-inline-result" class="search-inline-result" role="status" aria-live="polite"></div>
    </div>

    <!-- Expandable sections -->
    <div id="search-expandable-sections" class="search-expandable-sections">
      <div class="search-sections-content">
        <div id="search-date-section" class="search-date-section" style="display:none;"></div>
        <div id="search-categories-section" class="search-categories-section" style="display:none;">
          <div id="search-category-grid" class="search-category-grid"></div>
        </div>
        <div id="search-active-filters" class="search-active-filters" style="display:none;"></div>
      </div>
    </div>
  </div>
</div>