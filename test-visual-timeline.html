<!DOCTYPE html>
<html>
<head>
    <title>Visual Timeline Test</title>
    <style>
        .test-results {
            background: #f0f0f0;
            padding: 20px;
            margin: 20px;
            border-radius: 8px;
        }
        .test-button {
            background: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #45a049;
        }
    </style>
</head>
<body>
    <h1>Visual Timeline Test</h1>
    <div class="test-results">
        <h2>Test Controls</h2>
        <button class="test-button" onclick="checkVisualElements()">1. Check Visual Timeline Elements</button>
        <button class="test-button" onclick="checkHistogramBars()">2. Check Histogram Bars</button>
        <button class="test-button" onclick="checkConsoleOutput()">3. Check Console Output</button>
        <button class="test-button" onclick="refreshTimeline()">4. Refresh Timeline</button>
        
        <h2>Results:</h2>
        <pre id="results">Click a test button to see results...</pre>
    </div>
    
    <h2>Timeline Below:</h2>
    <iframe id="timeline-frame" src="timeline.html?cache=false" style="width: 100%; height: 800px; border: 1px solid #ccc;"></iframe>
    
    <script>
        function log(message) {
            document.getElementById('results').textContent += message + '\n';
        }
        
        function clearLog() {
            document.getElementById('results').textContent = '';
        }
        
        function getTimelineDocument() {
            return document.getElementById('timeline-frame').contentDocument;
        }
        
        function getTimelineWindow() {
            return document.getElementById('timeline-frame').contentWindow;
        }
        
        function checkVisualElements() {
            clearLog();
            log('=== Checking Visual Timeline Elements ===');
            
            try {
                var doc = getTimelineDocument();
                var visualContainer = doc.querySelector('.visual-timeline-container');
                var periods = doc.querySelector('.timeline-periods');
                var histogram = doc.querySelector('.timeline-histogram');
                var labels = doc.querySelector('.timeline-labels');
                
                log('Visual timeline container found: ' + (visualContainer ? 'YES' : 'NO'));
                log('Periods container found: ' + (periods ? 'YES' : 'NO'));
                log('Histogram container found: ' + (histogram ? 'YES' : 'NO'));
                log('Labels container found: ' + (labels ? 'YES' : 'NO'));
                
                if (periods) {
                    var periodDivs = periods.querySelectorAll('.timeline-period');
                    log('\nPeriod divs found: ' + periodDivs.length);
                    if (periodDivs.length > 0) {
                        log('First 3 periods:');
                        for (var i = 0; i < Math.min(3, periodDivs.length); i++) {
                            log('  ' + (i+1) + '. ' + periodDivs[i].textContent);
                        }
                    }
                }
                
                if (histogram) {
                    var histogramBars = histogram.querySelectorAll('.histogram-bar');
                    log('\nHistogram bars found: ' + histogramBars.length);
                }
            } catch (e) {
                log('ERROR: ' + e.message);
            }
        }
        
        function checkHistogramBars() {
            clearLog();
            log('=== Checking Histogram Bars ===');
            
            try {
                var doc = getTimelineDocument();
                var histogram = doc.querySelector('.timeline-histogram');
                
                if (!histogram) {
                    log('ERROR: Histogram container not found!');
                    return;
                }
                
                var bars = histogram.querySelectorAll('.histogram-bar');
                log('Total histogram bars: ' + bars.length);
                
                // Check bar heights
                var nonZeroBars = 0;
                for (var i = 0; i < bars.length; i++) {
                    var height = bars[i].style.height;
                    if (height && height !== '3px') {
                        nonZeroBars++;
                    }
                }
                log('Bars with data (height > 3px): ' + nonZeroBars);
                
                // Show details of first few bars with data
                log('\nFirst 5 bars with data:');
                var count = 0;
                for (var i = 0; i < bars.length && count < 5; i++) {
                    var bar = bars[i];
                    if (bar.style.height && bar.style.height !== '3px') {
                        log('  Bar ' + i + ': height=' + bar.style.height + ', title="' + bar.title + '"');
                        count++;
                    }
                }
            } catch (e) {
                log('ERROR: ' + e.message);
            }
        }
        
        function checkConsoleOutput() {
            clearLog();
            log('=== Checking Console Output ===');
            log('Please check the browser console (F12) for debug output from the visual timeline initialization.');
            log('\nExpected console messages:');
            log('- "Initializing visual timeline navigator..."');
            log('- "Active centuries: [list of centuries]"');
            log('- "Year range: X to Y"');
            log('- "Creating histogram bars. Active centuries: N"');
            log('- "Histogram data: [array]"');
            log('- "Max count: N"');
        }
        
        function refreshTimeline() {
            clearLog();
            log('=== Refreshing Timeline ===');
            document.getElementById('timeline-frame').src = 'timeline.html?cache=false&t=' + Date.now();
            log('Timeline refreshed. Wait for it to load and then run the tests again.');
        }
    </script>
</body>
</html>