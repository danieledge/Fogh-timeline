<!DOCTYPE html>
<html>
<head>
    <title>Visual Timeline Debug</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
        }
        .test-visual-timeline {
            background: #f0f0f0;
            border-radius: 12px;
            padding: 20px;
            position: relative;
            height: 120px;
            margin: 20px 0;
        }
        .test-histogram {
            position: absolute;
            bottom: 30px;
            left: 20px;
            right: 20px;
            height: 50px;
            display: flex;
            align-items: flex-end;
            gap: 2px;
            background: rgba(255,0,0,0.1);
        }
        .test-bar {
            flex: 1;
            background: #257b46;
            opacity: 0.6;
            min-height: 5px;
            border-radius: 2px 2px 0 0;
        }
        .test-labels {
            position: absolute;
            bottom: 5px;
            left: 20px;
            right: 20px;
            display: flex;
            font-size: 0.7rem;
        }
        .debug-output {
            background: #333;
            color: #0f0;
            padding: 10px;
            font-family: monospace;
            white-space: pre;
            overflow: auto;
            max-height: 300px;
        }
    </style>
</head>
<body>
    <h1>Visual Timeline Debug Test</h1>
    
    <h2>1. Static Test Visual Timeline</h2>
    <div class="test-visual-timeline">
        <div style="position: absolute; top: 10px; left: 20px; right: 20px;">
            <span>1st C</span> | <span>5th C</span> | <span>11th C</span> | <span>19th C</span> | <span>20th C</span>
        </div>
        <div class="test-histogram">
            <div class="test-bar" style="height: 20%;" title="2 events"></div>
            <div class="test-bar" style="height: 40%;" title="4 events"></div>
            <div class="test-bar" style="height: 10%;" title="1 event"></div>
            <div class="test-bar" style="height: 80%;" title="8 events"></div>
            <div class="test-bar" style="height: 100%;" title="10 events"></div>
        </div>
        <div class="test-labels">
            <span style="flex: 1;">43</span>
            <span style="flex: 1;">410</span>
            <span style="flex: 1;">1066</span>
            <span style="flex: 1;">1854</span>
            <span style="flex: 1;">2024</span>
        </div>
    </div>
    
    <h2>2. Live Timeline Debug</h2>
    <button onclick="checkTimeline()">Check Timeline Status</button>
    <button onclick="checkDOM()">Check DOM Elements</button>
    <button onclick="manualInit()">Manual Initialize</button>
    
    <h3>Debug Output:</h3>
    <div class="debug-output" id="debug"></div>
    
    <h2>3. Timeline Frame</h2>
    <iframe id="timeline-frame" src="timeline.html?cache=false" style="width: 100%; height: 600px; border: 1px solid #ccc;"></iframe>
    
    <script>
        function log(msg) {
            document.getElementById('debug').textContent += msg + '\n';
        }
        
        function checkTimeline() {
            document.getElementById('debug').textContent = '';
            try {
                var iframe = document.getElementById('timeline-frame');
                var iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                var iframeWin = iframe.contentWindow;
                
                log('=== Checking Timeline Status ===');
                log('Document ready state: ' + iframeDoc.readyState);
                log('Timeline data available: ' + (iframeWin.timelineData ? 'YES (' + iframeWin.timelineData.length + ' items)' : 'NO'));
                
                // Check if functions exist
                log('\nFunctions:');
                log('initializeVisualTimeline exists: ' + (typeof iframeWin.initializeVisualTimeline === 'function' ? 'YES' : 'NO'));
                log('initializeTimelineSearch exists: ' + (typeof iframeWin.initializeTimelineSearch === 'function' ? 'YES' : 'NO'));
                
                // Check containers
                var visualContainer = iframeDoc.querySelector('.visual-timeline-container');
                var histogram = iframeDoc.querySelector('.timeline-histogram');
                
                log('\nContainers:');
                log('Visual timeline container: ' + (visualContainer ? 'EXISTS' : 'NOT FOUND'));
                log('Histogram container: ' + (histogram ? 'EXISTS' : 'NOT FOUND'));
                
                if (histogram) {
                    var bars = histogram.querySelectorAll('.histogram-bar');
                    log('Histogram bars: ' + bars.length);
                }
                
            } catch (e) {
                log('ERROR: ' + e.message);
            }
        }
        
        function checkDOM() {
            document.getElementById('debug').textContent = '';
            try {
                var iframe = document.getElementById('timeline-frame');
                var iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                
                log('=== Checking DOM Structure ===');
                
                // Check visual timeline structure
                var visualContainer = iframeDoc.querySelector('.visual-timeline-container');
                if (visualContainer) {
                    log('Visual container HTML:');
                    log(visualContainer.innerHTML.substring(0, 500) + '...');
                    
                    var computedStyle = getComputedStyle(visualContainer);
                    log('\nVisual container styles:');
                    log('display: ' + computedStyle.display);
                    log('visibility: ' + computedStyle.visibility);
                    log('opacity: ' + computedStyle.opacity);
                }
                
                var histogram = iframeDoc.querySelector('.timeline-histogram');
                if (histogram) {
                    log('\nHistogram container children: ' + histogram.children.length);
                    if (histogram.children.length > 0) {
                        log('First bar height: ' + histogram.children[0].style.height);
                    }
                }
                
            } catch (e) {
                log('ERROR: ' + e.message);
            }
        }
        
        function manualInit() {
            document.getElementById('debug').textContent = '';
            try {
                var iframe = document.getElementById('timeline-frame');
                var iframeWin = iframe.contentWindow;
                
                log('=== Manual Initialization ===');
                
                if (typeof iframeWin.initializeVisualTimeline === 'function') {
                    log('Calling initializeVisualTimeline()...');
                    iframeWin.initializeVisualTimeline();
                    log('Function called. Check browser console for output.');
                } else {
                    log('ERROR: initializeVisualTimeline function not found');
                }
                
            } catch (e) {
                log('ERROR: ' + e.message);
            }
        }
        
        // Auto-check after load
        window.addEventListener('load', function() {
            setTimeout(checkTimeline, 2000);
        });
    </script>
</body>
</html>